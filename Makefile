CC?= gcc
CFLAGS=                                 \
	-Wall                               \
	-Wextra                             \
	-Wpedantic                          \
	-std=c89                            \
	-Wno-overlength-strings             \
	-Wint-conversion                    \
	-Wimplicit-fallthrough              \
	-Wshadow                            \
	-Wcast-qual                         \
	-Wconversion                        \
	-Wdouble-promotion                  \
	-Wfloat-equal                       \
	-Wformat=2                          \
	-Wformat-signedness                 \
	-Winit-self                         \
	-Wstrict-prototypes                 \
	-Wswitch-default                    \
	-Wswitch-enum                       \
	-Wundef                             \
	-Wunused-macros                     \
	-Wwrite-strings                     \
	-Wcast-align                        \
	-Wunreachable-code                  \
	-Wpointer-arith                     \
	-Wnull-dereference                  \
	-ggdb                               \
	-fstack-protector-all               \
	-fstack-check                       \
	-fsanitize=address,undefined        \
	-fsanitize-address-use-after-scope  \
	-ftrapv								
#   -mshstk #(not available on all platforms)



TRASH= $(shell if which trash 2>/dev/null 1>&2; then echo trash; else echo rm; fi)

all: run

run: example
	./example

example: autogenerated.c
	$(CC) $(CFLAGS) example.c -o example

autogenerated.c: stage_1
	./stage_1

stage_1: example.c core.h Makefile
	$(CC) $(CFLAGS) -DSTAGE_1 example.c -o stage_1

clean:
	if [ -e example ];          then $(TRASH) example;       	fi
	if [ -e autogenerated.c ];  then $(TRASH) autogenerated.c;	fi
	if [ -e autogenerated.o ];  then $(TRASH) autogenerated.o;	fi
	if [ -e build ];            then $(TRASH) build;        	fi
	if [ -e stage_1 ];          then $(TRASH) stage_1;        	fi
	if [ -e a.out ];            then $(TRASH) a.out;        	fi

.PHONY: clean run all
