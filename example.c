#define CORE_IMPLEMENTATION
#include "core.h"

#ifndef STAGE_1
#    include "autogenerated.c"
#endif /* !STAGE_1 */

int main() {
#ifdef STAGE_1
    FILE * fp = fopen("autogenerated.c", "w");
    CORE_DEFER(cleanup) {
        fclose(fp);
    }
    core_staged_vec_generate(fp, "example_", "int");
    CORE_DEFERRED(cleanup);
#else
    example_IntVec v = {0};
    CORE_DEFER(cleanup) {
        example_intvec_free(&v);
    }

    example_intvec_append_n_times(&v, 0xFF, 1000);
    assert(v.len == 1000);
    example_intvec_append(&v, 11);
    assert(v.items[100] == 0xFF);
    assert(v.items[1000] == 11);
    printf("%d\n", v.items[123]);
    CORE_DEFERRED(cleanup);

#endif /* STAGE_1 */
    return 0;
}
